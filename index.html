<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×™×“×¢ ×›×œ×œ×™ â€¢ 500 â€¢ ××“ ×¢×’×•×œ â€¢ ×”×“×¨×’×ª×™×•×ª ×œ×¤×™ × ×•×©×</title>
  <style>
    :root{
      --bg:#0b1220; --ink:#e9eefc; --muted:#a9b4d6; --line:rgba(255,255,255,.10);
      --accent:#6ea8ff; --good:#4ade80; --bad:#fb7185; --warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Hebrew",sans-serif;
      background:
        radial-gradient(1200px 800px at 70% -10%, rgba(110,168,255,.35), transparent 55%),
        radial-gradient(900px 700px at 10% 0%, rgba(251,113,133,.22), transparent 50%),
        var(--bg);
      color:var(--ink);
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    header{
      display:flex;gap:12px;align-items:flex-start;justify-content:space-between;
      padding:14px;border:1px solid var(--line);border-radius:18px;
      background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      backdrop-filter:blur(8px)
    }
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;line-height:1.35;margin-top:4px}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start}
    .pill{
      border:1px solid var(--line);border-radius:999px;padding:6px 10px;
      font-size:12px;color:var(--muted);background:rgba(255,255,255,.03);
      display:inline-flex;gap:6px;align-items:center
    }
    .pill b{color:var(--ink);font-weight:900}
    main{margin-top:14px;display:grid;grid-template-columns:1.15fr .85fr;gap:14px}
    @media (max-width:900px){main{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.03);padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row.space{justify-content:space-between;align-items:flex-start}
    button{
      border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--ink);
      padding:10px 12px;border-radius:14px;cursor:pointer;font-weight:900;font-size:14px
    }
    button:hover{border-color:rgba(255,255,255,.22)}
    button.primary{background:rgba(110,168,255,.18);border-color:rgba(110,168,255,.45)}
    button.good{background:rgba(74,222,128,.16);border-color:rgba(74,222,128,.45)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .meta{color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    .tag{
      display:inline-flex;gap:6px;align-items:center;padding:6px 9px;border-radius:999px;
      border:1px solid var(--line);background:rgba(255,255,255,.02);
      font-size:12px;color:var(--muted);margin:2px 6px 2px 0
    }
    .progress{height:10px;border-radius:999px;border:1px solid var(--line);overflow:hidden;background:rgba(255,255,255,.03)}
    .bar{height:100%;width:0%;background:rgba(110,168,255,.55)}
    .qtext{font-size:17px;line-height:1.55;margin:10px 0 10px}
    .answers{display:grid;gap:10px;margin-top:10px}
    .ans{
      text-align:right;padding:12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);cursor:pointer;display:flex;gap:10px;align-items:flex-start
    }
    .ans:hover{border-color:rgba(255,255,255,.22)}
    .ans .key{
      width:26px;height:26px;border-radius:9px;display:flex;align-items:center;justify-content:center;
      border:1px solid var(--line);color:var(--muted);font-weight:900;flex:0 0 auto;background:rgba(0,0,0,.12)
    }
    .ans .label{flex:1}
    .ans.correct{border-color:rgba(74,222,128,.6);background:rgba(74,222,128,.10)}
    .ans.wrong{border-color:rgba(251,113,133,.6);background:rgba(251,113,133,.09)}
    .box{margin-top:10px;padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(0,0,0,.12);line-height:1.55}
    .small{color:var(--muted);font-size:12px;line-height:1.45}
    .statgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stat{border:1px solid var(--line);border-radius:14px;padding:10px;background:rgba(255,255,255,.02)}
    .stat .k{color:var(--muted);font-size:12px}
    .stat .v{font-size:18px;font-weight:900;margin-top:2px}

    canvas{width:100%;height:auto;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.02)}

    .toast{
      position:fixed;bottom:14px;left:14px;right:14px;max-width:980px;margin:0 auto;
      padding:10px 12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none;color:var(--ink)
    }

    .badgeRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .badge{
      display:inline-flex;gap:8px;align-items:center;
      border:1px solid var(--line);background:rgba(255,255,255,.02);
      border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)
    }
    .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.20);border:1px solid rgba(255,255,255,.14)}
    .bname{color:var(--ink);font-weight:900}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}

    /* meter row */
    .meters{display:grid;grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    @media (max-width:900px){.meters{grid-template-columns:1fr}}
    .meterCard{border:1px solid var(--line);border-radius:16px;background:rgba(255,255,255,.02);padding:10px}
    .meterTitle{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .meterTitle b{font-size:13px}
    .meterTitle span{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div style="flex:1">
      <h1>×™×“×¢ ×›×œ×œ×™ â€¢ 500 â€¢ ××“ ×¢×’×•×œ â€¢ ×”×“×¨×’×ª×™×•×ª ×œ×¤×™ × ×•×©×</h1>
      <div class="sub">
        ×œ×›×œ ×ª×—×•× ×™×© ×¨××ª ×§×•×©×™ ××©×œ×• (1â€“5) ×©×¢×•×œ×” ×¨×§ ×¢× ×”×¦×œ×—×•×ª ×¢×§×‘×™×•×ª. ×—×–×¨×•×ª â€œ× ×“×—×¤×•×ªâ€ ×‘×¦×•×¨×” ××‘×•×§×¨×ª ×•×œ× ×©×•×‘×¨×•×ª ×¡×“×¨.
      </div>
    </div>
    <div class="pillrow">
      <div class="pill">Overall: <b id="overallPill">â€”</b></div>
      <div class="pill">×“×™×•×§: <b id="accPill">â€”</b></div>
      <div class="pill">× ×¢× ×•: <b id="answeredPill">0</b></div>
      <div class="pill">×¨×¦×£: <b id="streakPill">0</b> ğŸ”¥</div>
      <div class="pill">×××’×¨: <b>500</b></div>
    </div>
  </header>

  <main>
    <section class="card">
      <div id="screen_intro">
        <div class="row space">
          <div>
            <div class="qtext" style="margin:0">×”×ª×—×œ×”</div>
            <div class="small">×˜×™×¤ ×•×•××˜×¡××¤: ×œ×¤×ª×•×— ××ª ×”×§×™×©×•×¨ ×‘×“×¤×“×¤×Ÿ (Chrome). ××§×©×™×: 1â€“4 ×œ×‘×—×™×¨×”, N ×œ×©××œ×” ×”×‘××”.</div>
            <div class="box small" style="margin-top:10px">
              ×”×“×¨×’×ª×™×•×ª: ×›×œ × ×•×©× ××ª×—×™×œ ×§×œ (×¨××” 1). ××—×¨×™ ×¡×“×¨×ª ×”×¦×œ×—×•×ª ×”× ×•×©× ×¢×•×œ×” ×¨××”.
            </div>
          </div>
          <div class="row">
            <button class="primary" id="startBtn">×”×ª×—×™×œ×™</button>
            <button id="resetBtn">××™×¤×•×¡</button>
          </div>
        </div>
      </div>

      <div id="screen_quiz" style="display:none">
        <div class="row space">
          <div>
            <div class="meta" id="qMeta"></div>
            <div class="qtext" id="qText">â€”</div>
          </div>
          <div class="row">
            <button id="skipBtn">×“×œ×’×™</button>
          </div>
        </div>

        <div class="meters">
          <div class="meterCard">
            <div class="meterTitle"><b>××“ ×¢×’×•×œ: Overall</b><span id="overallLabel">â€”</span></div>
            <canvas id="meterOverall" width="900" height="260"></canvas>
            <div class="small">××©×§×œ×•×œ: ×“×™×•×§ + ×¢×•××§ ×ª×¨×’×•×œ. (×œ× ××•×©×¤×¢ ×××©×ª××©×™× ××—×¨×™×)</div>
          </div>
          <div class="meterCard">
            <div class="meterTitle"><b>××“ ×¢×’×•×œ: ×”× ×•×©× ×”× ×•×›×—×™</b><span id="topicLabel">â€”</span></div>
            <canvas id="meterTopic" width="900" height="260"></canvas>
            <div class="small">××‘×•×¡×¡ ×¢×œ ×‘×™×¦×•×¢×™× ×‘×ª×•×š ×”× ×•×©× ×‘×œ×‘×“ + ××™× ×™××•× × ×™×¡×™×•× ×•×ª.</div>
          </div>
        </div>

        <div class="progress" style="margin:10px 0 8px"><div class="bar" id="xpBar"></div></div>
        <div class="small" id="xpText">×”×ª×§×“××•×ª ×‘× ×•×©×: â€”</div>

        <div class="answers" id="answers"></div>

        <div class="box" id="feedbackBox" style="display:none">
          <div id="feedbackText"></div>
          <div class="small" id="hintText" style="margin-top:6px"></div>
          <div class="row" style="margin-top:10px">
            <button class="good" id="nextBtn">×©××œ×” ×”×‘××”</button>
            <button id="flagBtn">×¡×× ×™ ×œ×—×–×¨×”</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="card">
      <div class="row space">
        <div>
          <div class="qtext" style="margin:0">×›×¨×˜×™×¡ ×™×“×¢</div>
          <div class="small">×¨×“××¨ ×œ×¤×™ ×ª×—×•××™× + ×“×¨×’×•×ª + ×”×ª×§×“××•×ª ×–××Ÿ + ×©××™×¨×ª PNG.</div>
        </div>
        <div class="row">
          <button id="savePngBtn">×©××•×¨ ×›×¨×˜×™×¡ (PNG)</button>
          <button id="copyStatsBtn">×”×¢×ª×§ ×“×•×—</button>
        </div>
      </div>

      <div class="statgrid" style="margin-top:10px">
        <div class="stat"><div class="k">× ×¢× ×•</div><div class="v" id="answeredStat">0</div></div>
        <div class="stat"><div class="k">× ×›×•×Ÿ</div><div class="v" id="correctStat">0</div></div>
        <div class="stat"><div class="k">×—×–×¨×•×ª ×‘×ª×•×¨</div><div class="v" id="reviewStat">0</div></div>
        <div class="stat"><div class="k">×¨××” ×‘× ×•×©× × ×•×›×—×™</div><div class="v" id="topicLvlStat">â€”</div></div>
      </div>

      <div id="shareCard" class="box" style="margin-top:10px">
        <div class="small"><b>×˜×‘×¢×ª Overall + ×¡×˜×˜×•×¡</b></div>
        <canvas id="donut" width="900" height="280"></canvas>

        <div class="small" style="margin-top:10px"><b>×¨×“××¨ ×™×“×¢ ×œ×¤×™ ×ª×—×•××™×</b></div>
        <canvas id="radar" width="900" height="560"></canvas>

        <div class="small" style="margin-top:10px"><b>×“×¨×’×•×ª ×œ×¤×™ ×ª×—×•×</b></div>
        <div id="badges" class="badgeRow"></div>

        <div class="small" style="margin-top:10px"><b>×—×–×§×•×ª / ×—×œ×©×•×ª</b></div>
        <div id="strengthWeak" class="small" style="margin-top:6px"></div>
      </div>

      <div class="box" style="margin-top:10px">
        <div class="row space">
          <div class="small"><b>×”×™×¡×˜×•×¨×™×™×ª ×”×ª×§×“××•×ª</b></div>
          <div class="row">
            <button id="w7Btn" class="primary">7 ×™××™×</button>
            <button id="w30Btn">30 ×™××™×</button>
          </div>
        </div>
        <canvas id="timeline" width="900" height="320" style="margin-top:8px"></canvas>
        <div class="small" style="margin-top:6px">
          Overall (×—×œ×•×Ÿ) + Accuracy ×™×•××™.
        </div>
      </div>

      <div class="box small mono" style="margin-top:10px">
        Seed: <span id="seedBox"></span> â€¢ ×¢×“×›×•×Ÿ ×”××ª×¨ = Commit ×œÖ¾index.html
      </div>
    </aside>
  </main>

  <div class="toast" id="toast"></div>
</div>

<script>
/* ===================== Core ===================== */
const LS_KEY="gk500_topicprog_v2";
const SEED = 222905;
document.getElementById("seedBox").textContent = String(SEED);

const TOPICS=[
  "×”×™×¡×˜×•×¨×™×”","××™×©×™×","×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”","×¦×‘× ×•×‘×™×˜×—×•×Ÿ","×›×œ×›×œ×”","××“×¢",
  "×’×™××•×’×¨×¤×™×”","×ª×¨×‘×•×ª ×•××•×× ×•×ª","×¡×¤×¨×•×ª","×˜×›× ×•×œ×•×’×™×”","×¡×‘×™×‘×”","×¡×¤×•×¨×˜"
];

function $(id){return document.getElementById(id)}
function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
function now(){return Date.now()}
function fmtPct(x){return (x==null)?"â€”":Math.round(x*100)+"%"}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function toast(msg){const el=$("toast"); el.textContent=msg; el.style.display="block"; clearTimeout(toast._t); toast._t=setTimeout(()=>el.style.display="none",1800)}
function loadState(){try{const r=localStorage.getItem(LS_KEY); return r?JSON.parse(r):null}catch(e){return null}}
function saveState(){localStorage.setItem(LS_KEY, JSON.stringify(state))}
function hardReset(){localStorage.removeItem(LS_KEY); location.reload()}

/* ---------- PRNG (deterministic) ---------- */
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
function pick(rng, arr){ return arr[Math.floor(rng()*arr.length)] }
function shuffle(rng, arr){
  const a=arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(rng()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ===================== Question Bank (500 fixed) ===================== */
/* NOTE: This is the same concept-based generator as before (stable facts),
   but now difficulty is used *within each topic* via TopicLevel mapping. */

const CONCEPTS = [
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"×“××•×§×¨×˜×™×” ×™×™×¦×•×’×™×ª", def:"×©×™×˜×” ×©×‘×” ×”×¦×™×‘×•×¨ ×‘×•×—×¨ × ×¦×™×’×™× ×©××§×‘×œ×™× ×”×—×œ×˜×•×ª ×‘×©××•."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"××©××œ ×¢×", def:"×”×¦×‘×¢×” ×›×œ×œ×™×ª ×©×œ ×¦×™×‘×•×¨ ×”×‘×•×—×¨×™× ×¢×œ ×¡×•×’×™×” ××—×ª ××•×’×“×¨×ª."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×”×¤×¨×“×ª ×¨×©×•×™×•×ª", def:"×—×œ×•×§×ª ×¡××›×•×™×•×ª ×‘×™×Ÿ ××—×•×§×§×ª, ××‘×¦×¢×ª ×•×©×•×¤×˜×ª ×›×“×™ ×œ×¦××¦× ×¨×™×›×•×– ×›×•×—."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××™×–×•× ×™× ×•×‘×œ××™×", def:"×× ×’× ×•× ×™× ×©×××¤×©×¨×™× ×œ×¨×©×•×™×•×ª ×œ×¤×§×— ×–×• ×¢×œ ×–×• ×•×œ×”×’×‘×™×œ ×©×™××•×© ×œ×¨×¢×” ×‘×›×•×—."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×©×œ×˜×•×Ÿ ×”×—×•×§", def:"×¢×™×§×¨×•×Ÿ ×©×œ×¤×™×• ×’× ×”×©×œ×˜×•×Ÿ ×›×¤×•×£ ×œ×—×•×§ ×•×›×œ×œ×™× ×›×œ×œ×™×™× ×•×œ× ×œ×©×¨×™×¨×•×ª."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×¢×•×œ×", diff:3, term:"×¤×“×¨×œ×™×–×", def:"××‘× ×” ××“×™× ×™ ×”××—×œ×§ ×¡××›×•×™×•×ª ×‘×™×Ÿ ×××©×œ ××¨×›×–×™ ×œ×™×—×™×“×•×ª ××–×•×¨×™×•×ª (××“×™× ×•×ª/××—×•×–×•×ª)."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×¢×•×œ×", diff:3, term:"××©×˜×¨ × ×©×™××•×ª×™", def:"××©×˜×¨ ×©×‘×• ×”× ×©×™× × ×‘×—×¨ ×‘× ×¤×¨×“ ××”×¤×¨×œ×× ×˜ ×•××©××© ×¨××© ×”×¨×©×•×ª ×”××‘×¦×¢×ª."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××©×˜×¨ ×¤×¨×œ×× ×˜×¨×™", def:"×××©×œ×” ×©× ×©×¢× ×ª ×¢×œ ×××•×Ÿ ×”×¤×¨×œ×× ×˜ ×•×™×›×•×œ×” ×œ×™×¤×•×œ ×‘×”×¦×‘×¢×ª ××™-×××•×Ÿ."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×œ×’×™×˜×™××¦×™×”", def:"××§×•×¨ ×”×§×‘×œ×” ×•×”×”×¦×“×§×” ×œ×¡××›×•×ª ×©×œ×˜×•× ×™×ª (×‘×—×™×¨×•×ª, ×—×•×§, ××¡×•×¨×ª, ×‘×™×¦×•×¢×™×)."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×¢×•×œ×", diff:3, term:"×¤×•×¤×•×œ×™×–×", def:"×¡×’× ×•×Ÿ ×¤×•×œ×™×˜×™ ×©××“×’×™×© ×¢×™××•×ª '×”×¢×' ××•×œ '××œ×™×˜×•×ª' ×•×œ×¢×™×ª×™× ××¦×™×¢ ×¤×ª×¨×•× ×•×ª ×¤×©×•×˜×™× ×œ×‘×¢×™×•×ª ××•×¨×›×‘×•×ª."},
  {topic:"×¤×•×œ×™×˜×™×§×” ×•××“×™× ×”", region:"×¢×•×œ×", diff:4, term:"×’'×¨×™×× ×“×¨×™× ×’", def:"×©×¨×˜×•×˜ ×’×‘×•×œ×•×ª ××—×•×–×•×ª ×‘×—×™×¨×” ×‘××•×¤×Ÿ ×©××™×˜×™×‘ ×¤×•×œ×™×˜×™×ª ×¢× ×¦×“ ××¡×•×™×."},

  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"××™× ×¤×œ×¦×™×”", def:"×¢×œ×™×™×” ×›×œ×œ×™×ª ×•××ª××©×›×ª ×‘××—×™×¨×™× ×©××¤×—×™×ª×” ××ª ×›×•×— ×”×§× ×™×™×”."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"××™×ª×•×Ÿ", def:"×™×¨×™×“×” ×××•×©×›×ª ×‘×¤×¢×™×œ×•×ª ×›×œ×›×œ×™×ª, ×œ×¨×•×‘ ×¢× ×¢×œ×™×™×” ×‘××‘×˜×œ×”."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×“×¤×œ×¦×™×”", def:"×™×¨×™×“×” ×›×œ×œ×™×ª ×•××ª××©×›×ª ×‘××—×™×¨×™× (×œ×¢×™×ª×™× ××œ×•×•×” ×‘×™×¨×™×“×” ×‘×‘×™×§×•×©)."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×ª×•×¦×¨ ××§×•××™ ×’×•×œ××™ (GDP)", def:"××“×“ ×œ×¢×¨×š ×”×›×•×œ×œ ×©×œ ×¡×—×•×¨×•×ª ×•×©×™×¨×•×ª×™× ×©×™×•×¦×¨×• ×‘×›×œ×›×œ×” ×‘×–××Ÿ × ×ª×•×Ÿ."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××“×™× ×™×•×ª ×¤×™×¡×§×œ×™×ª", def:"×©×™××•×© ×‘×ª×§×¦×™×‘ ×”××“×™× ×”: ××™×¡×™× ×•×”×•×¦××•×ª ×›×“×™ ×œ×”×©×¤×™×¢ ×¢×œ ×”×›×œ×›×œ×”."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××“×™× ×™×•×ª ××•× ×™×˜×¨×™×ª", def:"×©×™××•×© ×‘×›×œ×™× ×›××• ×¨×™×‘×™×ª ×•×”×™×¦×¢ ×›×¡×£ (×‘× ×§ ××¨×›×–×™) ×›×“×™ ×œ×”×©×¤×™×¢ ×¢×œ ××™× ×¤×œ×¦×™×” ×•×¦××™×—×”."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×¨×™×‘×™×ª", def:"×”××—×™×¨ ×©×œ ×›×¡×£: ×”×ª×©×œ×•× ×¢×œ ×”×œ×•×•××” ××• ×”×ª×©×•××” ×¢×œ ×—×™×¡×›×•×Ÿ."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×”×™×¦×¢ ×•×‘×™×§×•×©", def:"××¡×’×¨×ª ×©××¡×‘×™×¨×” ×›×™×¦×“ ××—×™×¨ ×•×›××•×ª × ×§×‘×¢×™× ×‘×©×•×§ ×œ×¤×™ ×¨×¦×•×Ÿ ×œ×§× ×•×ª ××•×œ ×¨×¦×•×Ÿ ×œ××›×•×¨."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×™×ª×¨×•×Ÿ ×™×—×¡×™", def:"×™×›×•×œ×ª ×œ×™×™×¦×¨ ××•×¦×¨ ×‘×¢×œ×•×ª ××œ×˜×¨× ×˜×™×‘×™×ª × ××•×›×” ×™×—×¡×™×ª ×œ××—×¨×™×, ×‘×¡×™×¡ ×œ×¡×—×¨."},
  {topic:"×›×œ×›×œ×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:4, term:"×¢×œ×•×ª ××œ×˜×¨× ×˜×™×‘×™×ª", def:"××” ×©××•×•×ª×¨×™× ×¢×œ×™×• ×›×©×‘×•×—×¨×™× ××¤×©×¨×•×ª ××—×ª ×‘××§×•× ××—×¨×ª."},
  {topic:"×›×œ×›×œ×”", region:"×¢×•×œ×", diff:4, term:"××“×“ ×”××—×™×¨×™× ×œ×¦×¨×›×Ÿ (CPI)", def:"××“×“ ×©××•×“×“ ×©×™× ×•×™ ×‘××—×™×¨×™× ×©×œ ×¡×œ ××•×¦×¨×™× ×•×©×™×¨×•×ª×™× ×©×œ ××©×§×™ ×‘×™×ª."},

  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"DNA", def:"××•×œ×§×•×œ×” ×©× ×•×©××ª ××™×“×¢ ×’× ×˜×™ ×‘×ª××™×."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"×—×™×™×“×§", def:"×™×¦×•×¨ ×—×“-×ª××™ (×¤×¨×•×§×¨×™×•×˜) ×©×™×›×•×œ ×œ×—×™×•×ª ×‘×¡×‘×™×‘×•×ª ×¨×‘×•×ª."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"×•×™×¨×•×¡", def:"×’×•×¨× ×–×™×”×•××™ ×©×–×§×•×§ ×œ×ª× ×××¨×— ×›×“×™ ×œ×”×©×ª×›×¤×œ."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×”×©×¢×¨×”", def:"×˜×¢× ×”/× ×™×‘×•×™ ×©× ×™×ª×Ÿ ×œ×‘×“×•×§ ×‘× ×™×¡×•×™ ××• ×ª×¦×¤×™×ª."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×ª×™××•×¨×™×” ××“×¢×™×ª", def:"××¡×’×¨×ª ×”×¡×‘×¨ ××‘×•×¡×¡×ª ×¨××™×•×ª ×¨×‘×•×ª ×©××¡×•×’×œ×ª ×œ× ×‘× ×ª×•×¦××•×ª."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××ª××", def:"×§×©×¨ ×¡×˜×˜×™×¡×˜×™ ×‘×™×Ÿ ××©×ª× ×™× ×©××™× ×• ×‘×”×›×¨×— ×¡×™×‘×ª×™×•×ª."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×¡×™×‘×ª×™×•×ª", def:"×™×—×¡ ×©×‘×• ×©×™× ×•×™ ×‘-X ×’×•×¨× ×œ×©×™× ×•×™ ×‘-Y."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"× ×™×¡×•×™ ××‘×•×§×¨", def:"× ×™×¡×•×™ ×¢× ×ª× ××™× × ×©×œ×˜×™× ×•×§×‘×•×¦×ª ×‘×™×§×•×¨×ª ×œ×”×©×•×•××”."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×¤×•×˜×•×¡×™× ×ª×–×”", def:"×ª×”×œ×™×š ×©×‘×• ×¦××—×™× ××™×™×¦×¨×™× ×¡×•×›×¨×™× ×××•×¨, ××™× ×•-COâ‚‚ ×•××©×—×¨×¨×™× ×—××¦×Ÿ."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:4, term:"×× ×˜×¨×•×¤×™×”", def:"××“×“ ×œ××™-×¡×“×¨/××¡×¤×¨ ××¦×‘×™× ××¤×©×¨×™×™× ×‘××¢×¨×›×ª (×‘×”×§×©×¨ ×ª×¨××•×“×™× ××™)."},
  {topic:"××“×¢", region:"×™×©×¨××œ+×¢×•×œ×", diff:4, term:"×—×•×§ ×©× ×™ ×©×œ ×”×ª×¨××•×“×™× ××™×§×”", def:"×‘××•×¤×Ÿ ×›×œ×œ×™: ×× ×˜×¨×•×¤×™×” (××™-×¡×“×¨) ×‘××¢×¨×›×ª ×¡×’×•×¨×” × ×•×˜×” ×œ×¢×œ×•×ª."},

  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"×§×•×“ ×¤×ª×•×—", def:"×ª×•×›× ×” ×¢× ×§×•×“ ××§×•×¨ ×’×œ×•×™ ×œ×©×™××•×© ×•×©×™× ×•×™ ×œ×¤×™ ×¨×™×©×™×•×Ÿ."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"××œ×’×•×¨×™×ª×", def:"×¡×˜ ×¦×¢×“×™×/×›×œ×œ×™× ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×” ××• ×‘×™×¦×•×¢ ××©×™××”."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×”×¦×¤× ×”", def:"×”××¨×ª ××™×“×¢ ×œ×¦×•×¨×” ×©×œ× × ×™×ª×Ÿ ×œ×§×¨×•× ×‘×œ×™ ××¤×ª×— ××ª××™×."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×¤×™×©×™× ×’", def:"×”×ª×—×–×•×ª ×›×“×™ ×œ×’×¨×•× ×œ××©×ª××© ×œ××¡×•×¨ ×¡×™×¡××”/××™×“×¢ ×¨×’×™×©."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××™××•×ª ×“×•-×©×œ×‘×™ (2FA)", def:"××‘×˜×—×” ×©××•×¡×™×¤×” ×©×›×‘×ª ××™××•×ª × ×•×¡×¤×ª ××¢×‘×¨ ×œ×¡×™×¡××”."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×¢× ×Ÿ ××—×©×•×‘", def:"××¡×¤×§×ª ××©××‘×™ ××—×©×•×‘ (××—×¡×•×Ÿ/×©×¨×ª×™×) ×“×¨×š ×”××™× ×˜×¨× ×˜ ×œ×¤×™ ×¦×•×¨×š."},
  {topic:"×˜×›× ×•×œ×•×’×™×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:4, term:"×œ××™×“×ª ××›×•× ×”", def:"×©×™×˜×•×ª ×©×‘×”×Ÿ ××•×“×œ×™× ×œ×•××“×™× ×“×¤×•×¡×™× ×× ×ª×•× ×™× ×›×“×™ ×œ×—×–×•×ª/×œ×¡×•×•×’."},

  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"×”×¨×ª×¢×”", def:"×œ×’×¨×•× ×œ×™×¨×™×‘ ×œ×”×™×× ×¢ ××¤×¢×•×œ×” ×‘×’×œ×œ ×¢×œ×•×ª/×¡×™×›×•×Ÿ ×¦×¤×•×™×™×."},
  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:1, term:"××•×“×™×¢×™×Ÿ", def:"××™×¡×•×£ ×•× ×™×ª×•×— ××™×“×¢ ×œ×”×¤×—×ª×ª ××™-×•×“××•×ª ×•×ª××™×›×” ×‘×”×—×œ×˜×•×ª."},
  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×”×’× ×” ××–×¨×—×™×ª", def:"×”×™×¢×¨×›×•×ª ×œ×”×’×Ÿ ×¢×œ ××•×›×œ×•×¡×™×™×” ×•×ª×©×ª×™×•×ª ×‘×–××Ÿ ×—×™×¨×•×."},
  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"×“×•×§×˜×¨×™× ×”", def:"×¢×§×¨×•× ×•×ª ×× ×—×™× ×œ×”×¤×¢×œ×ª ×›×•×—/××“×™× ×™×•×ª ×‘×™×˜×—×•× ×™×ª."},
  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××œ×—××” ×”×™×‘×¨×™×“×™×ª", def:"×©×™×œ×•×‘ ×××¦×¢×™× ×¦×‘××™×™× ×•×œ×-×¦×‘××™×™× (×¡×™×™×‘×¨, ×ª×•×“×¢×”, ×›×œ×›×œ×”) ×‘××¢×¨×›×” ××—×ª."},
  {topic:"×¦×‘× ×•×‘×™×˜×—×•×Ÿ", region:"×™×©×¨××œ+×¢×•×œ×", diff:4, term:"×¡×™×™×‘×¨", def:"×ª×—×•× ×”×ª×§×™×¤×”/×”×’× ×” ×‘××¢×¨×›×•×ª ××—×©×•×‘, ×¨×©×ª×•×ª ×•× ×ª×•× ×™×."},

  {topic:"×’×™××•×’×¨×¤×™×”", region:"×¢×•×œ×", diff:1, term:"×§×• ×”××©×•×•×”", def:"×§×• ×¨×•×—×‘ 0Â° ×©××—×œ×§ ××ª ×”×¢×•×œ× ×œ×¦×¤×•×Ÿ ×•×œ×“×¨×•×."},
  {topic:"×’×™××•×’×¨×¤×™×”", region:"×¢×•×œ×", diff:1, term:"×§×• ×’×¨×™× ×™×¥' (××¨×™×“×™××Ÿ 0)", def:"×§×• ××•×¨×š 0Â° ×”××©××© ×‘×¡×™×¡ ×œ××“×™×“×ª ×§×•×•×™ ××•×¨×š ×•××–×•×¨×™ ×–××Ÿ."},
  {topic:"×’×™××•×’×¨×¤×™×”", region:"×¢×•×œ×", diff:3, term:"××§×œ×™×", def:"×“×¤×•×¡ ××–×’ ××•×•×™×¨ ××¨×•×š ×˜×•×•×— ×‘××–×•×¨ ××¡×•×™×."},

  {topic:"×¡×‘×™×‘×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"×§×™×™××•×ª", def:"×©×™××•×© ×‘××©××‘×™× ×‘××•×¤×Ÿ ×©××™× ×• ×¤×•×’×¢ ×‘×™×›×•×œ×ª ×”×“×•×¨×•×ª ×”×‘××™× ×œ×—×™×•×ª ×•×œ×©×’×©×’."},
  {topic:"×¡×‘×™×‘×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××’×•×•×Ÿ ×‘×™×•×œ×•×’×™", def:"×¢×•×©×¨ ×•×’×™×•×•×Ÿ ×©×œ ××™× ×™×, ×’× ×™× ×•××¢×¨×›×•×ª ××§×•×œ×•×’×™×•×ª."},
  {topic:"×¡×‘×™×‘×”", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××¤×§×˜ ×—×××”", def:"×ª×”×œ×™×š ×©×‘×• ×’×–×™× ×‘××˜××•×¡×¤×¨×” ×œ×•×›×“×™× ×—×•× ×•××¢×œ×™× ××ª ×”×˜××¤×¨×˜×•×¨×” ×”×××•×¦×¢×ª."},

  {topic:"×ª×¨×‘×•×ª ×•××•×× ×•×ª", region:"×¢×•×œ×", diff:2, term:"×¨× ×¡× ×¡", def:"×ª×§×•×¤×” ×©×œ '×œ×™×“×” ××—×“×©' ×‘××™×¨×•×¤×” ×¢× ×¢× ×™×™×Ÿ ××—×•×“×© ×‘×§×œ××¡×™×§×”, ××“×¢ ×•××•×× ×•×ª."},
  {topic:"×ª×¨×‘×•×ª ×•××•×× ×•×ª", region:"×¢×•×œ×", diff:2, term:"××™××¤×¨×¡×™×•× ×™×–×", def:"×¡×’× ×•×Ÿ ××•×× ×•×ª ×©××“×’×™×© ××•×¨ ×•×¨×•×©× ×¨×’×¢×™, ×¤×—×•×ª ×“×™×•×§ ×¨×™××œ×™×¡×˜×™."},

  {topic:"×¡×¤×¨×•×ª", region:"×™×©×¨××œ+×¢×•×œ×", diff:2, term:"××˜××¤×•×¨×”", def:"×“×™××•×™ ×œ×-××™×œ×•×œ×™ ×©××¢× ×™×§ ××©××¢×•×ª ×—×“×©×” ('×™× ×©×œ ×“××’×•×ª')."},
  {topic:"×¡×¤×¨×•×ª", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××™×¨×•× ×™×”", def:"×¤×¢×¨ ×‘×™×Ÿ ×”×¦×™×¤×™×™×”/×”× ×××¨ ×œ×‘×™×Ÿ ××” ×©×§×•×¨×” ×‘×¤×•×¢×œ ××• ××” ×©×”×§×•×¨× ××‘×™×Ÿ."},
  {topic:"×¡×¤×¨×•×ª", region:"×™×©×¨××œ+×¢×•×œ×", diff:3, term:"××¡×¤×¨ ×œ×-××”×™××Ÿ", def:"××¡×¤×¨ ×©×¡×™×¤×•×¨×• ××™× ×• ×‘×”×›×¨×— ×××™×Ÿ; ×”×§×•×¨× ××–×”×” ×¡×ª×™×¨×•×ª/×”×˜×™×•×ª."},

  {topic:"×¡×¤×•×¨×˜", region:"×¢×•×œ×", diff:1, term:"××•×œ×™××¤×™××“×”", def:"×ª×—×¨×•×ª ×¡×¤×•×¨×˜ ×‘×™× ×œ××•××™×ª ×¨×‘-×¢× ×¤×™×ª (×§×™×¥/×—×•×¨×£) ×œ×¤×™ ×›×œ×œ×™× ×¨×©××™×™×."},
  {topic:"×¡×¤×•×¨×˜", region:"×¢×•×œ×", diff:2, term:"×©×™× ×¢×•×œ×", def:"×”×ª×•×¦××” ×”×˜×•×‘×” ×‘×™×•×ª×¨ ×©× ××“×“×” ×‘××•×¤×Ÿ ×¨×©××™ ×‘×¢× ×£ ×œ×¤×™ ×”×›×œ×œ×™×."},

  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×¢×•×œ×", diff:1, term:"××œ×—××ª ×”×¢×•×œ× ×”×¨××©×•× ×”", def:"×¢×™××•×ª ×¢×•×œ××™ ×‘×©× ×™× 1914â€“1918 ×‘×™×Ÿ ×‘×¨×™×ª×•×ª ××¢×¦××•×ª."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×¢×•×œ×", diff:1, term:"××œ×—××ª ×”×¢×•×œ× ×”×©× ×™×™×”", def:"×¢×™××•×ª ×¢×•×œ××™ ×‘×©× ×™× 1939â€“1945."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×¢×•×œ×", diff:2, term:"×”××œ×—××” ×”×§×¨×”", def:"×¢×™××•×ª ×’×™××•-×¤×•×œ×™×˜×™ ×‘×™×Ÿ ×’×•×©×™× (××–×¨×—/××¢×¨×‘) ×‘×œ×™ ××œ×—××” ×™×©×™×¨×” ×›×•×œ×œ×ª."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×¢×•×œ×", diff:2, term:"× ×¤×™×œ×ª ×—×•××ª ×‘×¨×œ×™×Ÿ (1989)", def:"××™×¨×•×¢ ×©×¡×™××œ ×©×™× ×•×™×™ ××©×˜×¨ ×‘××™×¨×•×¤×” ×•×”××™×¥ ××ª ×¡×™×•× ×”××œ×—××” ×”×§×¨×”."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×¢×•×œ×", diff:3, term:"×”×©×¤×œ ×”×’×“×•×œ", def:"××©×‘×¨ ×›×œ×›×œ×™ ×¢×•×œ××™ ×—××•×¨ ×‘×¢×™×§×¨ ×‘×©× ×•×ª ×”-30."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×™×©×¨××œ", diff:1, term:"×”×›×¨×–×ª ×”××“×™× ×” (1948)", def:"×”×›×¨×–×ª ×¢×¦×××•×ª ×™×©×¨××œ ×•×”×§××ª ×”××“×™× ×” ×‘×©× ×ª 1948."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×™×©×¨××œ", diff:2, term:"×ª×•×›× ×™×ª ×”×—×œ×•×§×” (1947)", def:"×”×¦×¢×ª ×”××•×´× ×œ×—×œ×•×§×ª ×©×˜×— ×”×× ×“×˜ ×œ×©×ª×™ ××“×™× ×•×ª (×™×”×•×“×™×ª/×¢×¨×‘×™×ª)."},
  {topic:"×”×™×¡×˜×•×¨×™×”", region:"×™×©×¨××œ", diff:3, term:"××œ×—××ª ×©×©×ª ×”×™××™× (1967)", def:"××œ×—××” ×§×¦×¨×” ×©×”×•×‘×™×œ×” ×œ×©×™× ×•×™×™× ×˜×¨×™×˜×•×¨×™××œ×™×™× ××©××¢×•×ª×™×™× ×•×œ×”×©×œ×›×•×ª ××“×™× ×™×•×ª ××¨×•×›×•×ª."},

  {topic:"××™×©×™×", region:"×¢×•×œ×", diff:1, term:"××œ×‘×¨×˜ ××™×™× ×©×˜×™×™×Ÿ", def:"××“×¢×Ÿ ×”××–×•×”×” ×‘××™×•×—×“ ×¢× ×ª×•×¨×ª ×”×™×—×¡×•×ª."},
  {topic:"××™×©×™×", region:"×¢×•×œ×", diff:1, term:"××™×™×–×§ × ×™×•×˜×•×Ÿ", def:"××“×¢×Ÿ ×”××–×•×”×” ×¢× ×—×•×§×™ ×”×ª× ×•×¢×” ×”×§×œ××¡×™×™× ×•×”×›×‘×™×“×”."},
  {topic:"××™×©×™×", region:"×™×©×¨××œ", diff:2, term:"×“×•×“ ×‘×Ÿ-×’×•×¨×™×•×Ÿ", def:"×¨××© ×”×××©×œ×” ×”×¨××©×•×Ÿ ×©×œ ×™×©×¨××œ ×•×× ×”×™×’ ××¨×›×–×™ ×‘×”×›×¨×–×ª ×”×¢×¦×××•×ª."}
];

const SCENARIOS = [
  {term:"××™× ×¤×œ×¦×™×”", scenario:"×”××—×™×¨×™× ×©×œ ×¨×•×‘ ×”××•×¦×¨×™× ×¢×•×œ×™× ×œ××•×¨×š ×—×•×“×©×™× ×•×›×•×— ×”×§× ×™×™×” ×©×œ ×”×›×¡×£ ×™×•×¨×“."},
  {term:"×¢×œ×•×ª ××œ×˜×¨× ×˜×™×‘×™×ª", scenario:"×›×©×‘×—×¨×ª ×œ×œ××•×“ ×‘××§×•× ×œ×¢×‘×•×“, ×”×•×•×™×ª×•×¨ ×¢×œ ×”×”×›× ×¡×” ×”×•× '×”××—×™×¨' ×©×œ ×”×‘×—×™×¨×”."},
  {term:"××“×™× ×™×•×ª ××•× ×™×˜×¨×™×ª", scenario:"×‘× ×§ ××¨×›×–×™ ××¢×œ×” ×¨×™×‘×™×ª ×›×“×™ ×œ×§×¨×¨ ×‘×™×§×•×©×™× ×•×œ×”×¤×—×™×ª ×œ×—×¥ ××™× ×¤×œ×¦×™×•× ×™."},
  {term:"×”×¤×¨×“×ª ×¨×©×•×™×•×ª", scenario:"×”×¡××›×•×™×•×ª ××—×•×œ×§×•×ª ×›×“×™ ×©×××©×œ×” ×œ× ×ª×©×œ×•×˜ ×’× ×‘×—×§×™×§×” ×•×’× ×‘××©×¤×˜ ×‘×œ×™ ×¤×™×§×•×—."},
  {term:"×©×œ×˜×•×Ÿ ×”×—×•×§", scenario:"×’× ×”×©×œ×˜×•×Ÿ ×›×¤×•×£ ×œ×›×œ×œ×™× ×•×™×›×•×œ ×œ×¢××•×“ ×œ×“×™×Ÿ ×›××• ×›×œ ××–×¨×—."},
  {term:"×¤×“×¨×œ×™×–×", scenario:"×™×© ×××©×œ ××¨×›×–×™, ××‘×œ ×œ××—×•×–×•×ª/××“×™× ×•×ª ×™×© ×¡××›×•×™×•×ª ×—×§×™×§×” × ×¤×¨×“×•×ª."},
  {term:"×¤×™×©×™× ×’", scenario:"××™×™×œ ×©× ×¨××” ×›××• ×”×‘× ×§ ×•××‘×§×© ×œ×”×–×™×Ÿ ×¡×™×¡××” â€” × ×™×¡×™×•×Ÿ ×’× ×™×‘×”."},
  {term:"××™××•×ª ×“×•-×©×œ×‘×™ (2FA)", scenario:"××—×¨×™ ×¡×™×¡××” ××ª×§×‘×œ ×§×•×“ × ×•×¡×£ ×‘-SMS/××¤×œ×™×§×¦×™×”."},
  {term:"×”×¨×ª×¢×”", scenario:"××“×™× ×” × ×× ×¢×ª ××ª×§×™×¤×” ×›×™ ×”×™× ×—×•×©×©×ª ××”×ª×’×•×‘×” ×•××”××—×™×¨."},
  {term:"××ª××", scenario:"×©× ×™ ××©×ª× ×™× ×–×–×™× ×™×—×“ ×‘× ×ª×•× ×™× â€” ××‘×œ ×–×” ×œ× ××•×›×™×— ×¡×™×‘×ª×™×•×ª."},
  {term:"× ×™×¡×•×™ ××‘×•×§×¨", scenario:"×‘×•×“×§×™× ×ª×¨×•×¤×” ××•×œ ×§×‘×•×¦×ª ×‘×™×§×•×¨×ª ×›×“×™ ×œ×•×•×“× ×©×”×”×©×¤×¢×” ×œ× ××§×¨×™×ª."},
  {term:"××¤×§×˜ ×—×××”", scenario:"×’×–×™× ×‘××˜××•×¡×¤×¨×” ×œ×•×›×“×™× ×—×•× ×•××¢×œ×™× ×˜××¤×¨×˜×•×¨×” ×××•×¦×¢×ª."},
];

const TEMPLATE_TYPES=["DEF_TO_TERM","TERM_TO_DEF","SCENARIO_TERM"];

function makeQuestion_DefToTerm(rng, concept, pool){
  const correct = concept.term;
  const distractors = shuffle(rng, pool.filter(c=>c.topic===concept.topic && c.term!==correct).map(c=>c.term)).slice(0,3);
  const options = shuffle(rng, [correct, ...distractors]);
  const answer = options.indexOf(correct);
  return { topic: concept.topic, region: concept.region, difficulty: concept.diff,
    q: "××™×–×” ××•×©×’ ××ª××™× ×œ×”×’×“×¨×” ×”×‘××”?\n" + concept.def,
    options, answer,
    explain: "×”××•×©×’ ×”× ×›×•×Ÿ ×”×•×: " + correct + ". " + concept.def,
    hint: "(××•×©×’=×©× ×§×¦×¨ ×œ×¨×¢×™×•×Ÿ/×ª×•×¤×¢×”.)"
  };
}
function makeQuestion_TermToDef(rng, concept, pool){
  const correct = concept.def;
  const distractors = shuffle(rng, pool.filter(c=>c.topic===concept.topic && c.term!==concept.term).map(c=>c.def)).slice(0,3);
  const options = shuffle(rng, [correct, ...distractors]);
  const answer = options.indexOf(correct);
  return { topic: concept.topic, region: concept.region, difficulty: clamp(concept.diff+1,1,5),
    q: "××” ×”×”×’×“×¨×” ×”××“×•×™×§×ª ×‘×™×•×ª×¨ ×œ:\n" + concept.term,
    options, answer,
    explain: "×”×’×“×¨×” × ×›×•× ×”: " + correct,
    hint: "(×”×’×“×¨×”=×”×¡×‘×¨ ×§×¦×¨ ×œ××” ×–×”.)"
  };
}
function makeQuestion_Scenario(rng, pool){
  const sc = pick(rng, SCENARIOS);
  const correct = sc.term;
  const distractors = shuffle(rng, pool.filter(c=>c.term!==correct).map(c=>c.term)).slice(0,3);
  const options = shuffle(rng, [correct, ...distractors]);
  const answer = options.indexOf(correct);
  const c = pool.find(x=>x.term===correct) || {topic:"×›×œ×›×œ×”",region:"×™×©×¨××œ+×¢×•×œ×",diff:3,def:""};
  return { topic: c.topic, region: c.region, difficulty: clamp((c.diff||3)+1,1,5),
    q: "××™×–×” ××•×©×’ ××ª××¨ ×”×›×™ ×˜×•×‘ ××ª ×”××¦×‘ ×”×‘×?\n" + sc.scenario,
    options, answer,
    explain: "×”××•×©×’ ×”× ×›×•×Ÿ ×”×•×: " + correct + (c.def?(". " + c.def):""),
    hint: "(×ª×¨×—×™×©=×ª×™××•×¨ ××¦×‘.)"
  };
}
function generateBank500(){
  const rng = mulberry32(SEED);
  const pool = CONCEPTS.slice();
  const qs = [];
  let i=0;
  while(qs.length<500){
    const t = TEMPLATE_TYPES[Math.floor(rng()*TEMPLATE_TYPES.length)];
    const concept = pool[i % pool.length];
    let q;
    if(t==="DEF_TO_TERM") q = makeQuestion_DefToTerm(rng, concept, pool);
    else if(t==="TERM_TO_DEF") q = makeQuestion_TermToDef(rng, concept, pool);
    else q = makeQuestion_Scenario(rng, pool);
    q.id = "q_" + String(qs.length+1).padStart(3,"0");
    if(!q.options || q.options.length!==4) { i++; continue; }
    // keep a base difficulty from concept/template
    qs.push(q); i++;
  }
  return qs;
}
const BANK = generateBank500();

/* ===================== State ===================== */
let state = loadState() || {
  started:false,
  streak:0,
  answered:0, correct:0, acc:null,
  enabledTopics:Object.fromEntries(TOPICS.map(t=>[t,true])),
  seen:{}, reviewQueue:[], history:[],
  current:null, lock:false,
  windowDays:7,

  // NEW: per-topic progression
  topicProg: Object.fromEntries(TOPICS.map(t=>[t,{
    lvl:1, xp:0, // 0..100
    streakInTopic:0, // consecutive correct in this topic
    attempts:0, correct:0
  }]))
};

/* ===================== Reviews (controlled) ===================== */
/* We still schedule reviews, but only when the topic lvl is stable:
   - wrong: quick review
   - right after wrongs: spaced review
*/
function scheduleReview(qid, ok){
  const seen=state.seen[qid]||{correctCount:0,wrongCount:0,lastSeen:0,flagged:false};
  const wrongs=seen.wrongCount||0, corrects=seen.correctCount||0;
  let mins=0;
  if(!ok){
    mins = wrongs>=2 ? 2 : 5;
  } else if(wrongs>0){
    const stage=clamp(corrects,0,4);
    const sch=[10,60,24*60,3*24*60,7*24*60];
    mins=sch[stage];
  }
  if(mins>0) state.reviewQueue.push({id:qid,dueAt:now()+mins*60*1000});
}
function getDueReview(topic){
  // Controlled: only pull review if it's from SAME topic OR if queue is huge
  const t=now();
  state.reviewQueue.sort((a,b)=>a.dueAt-b.dueAt);
  const same = state.reviewQueue.find(x=>x.dueAt<=t && (BANK.find(q=>q.id===x.id)?.topic===topic));
  if(same){ state.reviewQueue=state.reviewQueue.filter(x=>x!==same); return BANK.find(q=>q.id===same.id)||null; }
  if(state.reviewQueue.length>=30){
    const any = state.reviewQueue.find(x=>x.dueAt<=t);
    if(any){ state.reviewQueue=state.reviewQueue.filter(x=>x!==any); return BANK.find(q=>q.id===any.id)||null; }
  }
  return null;
}

/* ===================== Topic Stats / Badges ===================== */
function badgeFor(score,total){
  if(total < 5) return "New";
  if(score < 0.55) return "Bronze";
  if(score < 0.70) return "Silver";
  if(score < 0.82) return "Gold";
  return "Platinum";
}
function badgeColor(name){
  if(name==="Platinum") return "rgba(110,168,255,.28)";
  if(name==="Gold") return "rgba(251,191,36,.20)";
  if(name==="Silver") return "rgba(233,238,252,.14)";
  if(name==="Bronze") return "rgba(251,113,133,.14)";
  return "rgba(255,255,255,.10)";
}
function topicStats(){
  const out = {};
  TOPICS.forEach(t=>out[t]={correct:0,wrong:0,total:0,score:0,badge:"â€”"});
  for(const q of BANK){
    const s = state.seen[q.id];
    if(!s) continue;
    const c = (s.correctCount||0);
    const w = (s.wrongCount||0);
    const t = q.topic;
    out[t].correct += c;
    out[t].wrong += w;
    out[t].total += (c+w);
  }
  for(const t of TOPICS){
    const a = out[t];
    const base = 0.35;
    const k = 6;
    const p = a.total ? (a.correct/a.total) : base;
    a.score = clamp(((p*a.total) + (base*k)) / (a.total + k),0,1);
    a.badge = badgeFor(a.score, a.total);
  }
  return out;
}
function strengthWeakList(stats){
  const arr = TOPICS.map(t=>({t,score:stats[t].score,total:stats[t].total}));
  const eligible = arr.filter(x=>x.total>=5);
  const best = eligible.slice().sort((a,b)=>b.score-a.score).slice(0,3);
  const worst = eligible.slice().sort((a,b)=>a.score-b.score).slice(0,3);
  return {best,worst};
}

/* ===================== Per-topic progression ===================== */
/* Hard guarantee: within a topic, we pick difficulty around topic lvl. */
function getTopicProg(topic){ return state.topicProg[topic] || (state.topicProg[topic]={lvl:1,xp:0,streakInTopic:0,attempts:0,correct:0}); }

function topicLevelRules(lvl){
  // required consecutive correct (within topic) + min accuracy in topic window
  // becomes stricter as lvl goes up
  if(lvl<=1) return {needStreak:3, minAcc:0.60};
  if(lvl===2) return {needStreak:4, minAcc:0.65};
  if(lvl===3) return {needStreak:5, minAcc:0.70};
  if(lvl===4) return {needStreak:6, minAcc:0.75};
  return {needStreak:999, minAcc:0.80};
}

function updateTopicProgress(topic, ok, qDifficulty){
  const tp = getTopicProg(topic);
  tp.attempts += 1;
  if(ok) tp.correct += 1;
  const acc = tp.attempts ? (tp.correct/tp.attempts) : 0;

  // XP is topic-local
  tp.xp += ok ? (10 + qDifficulty*4) : 2;
  tp.xp = clamp(tp.xp, 0, 120);

  // streak in topic
  tp.streakInTopic = ok ? (tp.streakInTopic+1) : 0;

  // Level up only when BOTH: xp>=100 and streak requirement met and accuracy met
  if(tp.lvl<5 && tp.xp>=100){
    const rule = topicLevelRules(tp.lvl);
    if(tp.streakInTopic>=rule.needStreak && acc>=rule.minAcc){
      tp.lvl += 1;
      tp.xp = 0;
      tp.streakInTopic = 0;
      toast(`×¨××” ×¢×œ×ª×” ×‘× ×•×©× "${topic}" âœ ${tp.lvl}/5 ğŸ‰`);
    } else {
      // hold near threshold to prevent "jumping"
      tp.xp = 92;
      toast("×›××¢×˜! ×¢×•×“ ×§×¦×ª ×‘×ª×•×š ×”× ×•×©× ğŸ™‚");
    }
  }

  state.topicProg[topic]=tp;
  return tp;
}

/* ===================== Selection (topic-first, gradual) ===================== */
function enabledTopicsList(){
  return TOPICS.filter(t=>state.enabledTopics[t]);
}

function pickTopic(){
  const enabled = enabledTopicsList();
  if(!enabled.length) return null;

  // weighted: prefer weaker topics + topics with lower lvl + topics not practiced recently
  const stats = topicStats();
  const weights = enabled.map(t=>{
    const tp = getTopicProg(t);
    const weakness = 1.15 - stats[t].score; // low score => higher weight
    const lvlBias = 1.25 - (tp.lvl-1)*0.10; // lower lvl => higher weight
    const practice = Math.max(1, tp.attempts);
    const exploration = 1.15 / Math.sqrt(practice); // prefer less practiced a bit
    const w = clamp(weakness*lvlBias*exploration, 0.25, 2.5);
    return {t,w};
  });
  const total = weights.reduce((s,x)=>s+x.w,0);
  let r = Math.random()*total;
  for(const x of weights){ r-=x.w; if(r<=0) return x.t; }
  return weights[weights.length-1].t;
}

function pickQuestion(){
  const topic = pickTopic();
  if(!topic) return null;

  // Controlled review injection (same topic only)
  if(state.reviewQueue.length){
    const rq = getDueReview(topic);
    if(rq && rq.topic===topic) return rq;
  }

  const tp = getTopicProg(topic);
  const target = tp.lvl;

  // filter bank by topic and target difficulty band
  const all = BANK.filter(q=>q.topic===topic);
  if(!all.length) return null;

  const band = (lvl)=>{
    if(lvl<=1) return [1,2];
    if(lvl===2) return [2,3];
    if(lvl===3) return [3,4];
    if(lvl===4) return [4,5];
    return [4,5];
  }
  const [lo,hi] = band(target);

  const candidates = all.filter(q=> (q.difficulty||3)>=lo && (q.difficulty||3)<=hi);
  const pool = candidates.length ? candidates : all;

  // deterministic-ish choice biased to unseen & flagged & past wrong
  const scored = pool.map(q=>{
    const seen = state.seen[q.id];
    const unseenBoost = seen ? 0.9 : 1.4;
    const wrongBoost = seen ? (1 + (seen.wrongCount||0)*0.35) : 1;
    const flaggedBoost = (seen && seen.flagged) ? 1.25 : 1;
    const diff = q.difficulty||3;
    const diffFit = 1/(1+Math.abs(diff - clamp(target+0.2,1,5)));
    return {q,w: unseenBoost*wrongBoost*flaggedBoost*diffFit};
  });

  const totalW = scored.reduce((s,x)=>s+x.w,0);
  let r = Math.random()*totalW;
  for(const x of scored){ r-=x.w; if(r<=0) return x.q; }
  return scored[scored.length-1].q;
}

/* ===================== Overall metrics ===================== */
function calcOverall(){
  const answered = state.answered||0;
  const acc = (state.acc==null)?0:(state.acc);
  const depth = clamp(Math.sqrt(answered/80),0,1);
  return clamp((acc*0.7)+(depth*0.3),0,1);
}

/* ===================== Canvas helpers ===================== */
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  r=Math.min(r,w/2,h/2);
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

/* ===================== Meters (circular) ===================== */
function drawCircularMeter(canvasId, value01, titleBig, subtitle, tone){
  const c=$(canvasId), ctx=c.getContext("2d");
  const w=c.width, h=c.height;
  ctx.clearRect(0,0,w,h);

  // background
  ctx.fillStyle="rgba(255,255,255,.02)";
  roundRect(ctx, 10, 10, w-20, h-20, 18, true, false);

  const v = clamp(value01,0,1);
  const cx = w*0.22, cy = h*0.55;
  const r  = Math.min(w,h)*0.28;

  // base ring
  ctx.lineWidth = 26;
  ctx.strokeStyle = "rgba(255,255,255,.10)";
  ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI); ctx.stroke();

  // progress ring
  ctx.strokeStyle = tone || "rgba(110,168,255,.75)";
  ctx.beginPath();
  ctx.arc(cx,cy,r,-Math.PI/2, -Math.PI/2 + v*2*Math.PI);
  ctx.stroke();

  // value
  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="900 34px system-ui";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(Math.round(v*100)+"%", cx, cy-6);

  ctx.fillStyle="rgba(169,180,214,.95)";
  ctx.font="700 14px system-ui";
  ctx.fillText(titleBig, cx, cy+28);

  // right text
  ctx.textAlign="right"; ctx.textBaseline="alphabetic";
  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="900 18px system-ui";
  ctx.fillText(subtitle, w-24, 54);

  ctx.fillStyle="rgba(169,180,214,.95)";
  ctx.font="600 13px system-ui";
  const lines = [
    "×× ×’× ×•×Ÿ: ×§×•×©×™ ×¢×•×œ×” ×‘×”×“×¨×’×”",
    "×—×–×¨×•×ª: ××‘×•×§×¨ (×œ× ×©×•×‘×¨ ×¡×“×¨)"
  ];
  lines.forEach((t,i)=>ctx.fillText(t, w-24, 86+i*22));
}

function toneForBadge(b){
  if(b==="Platinum") return "rgba(110,168,255,.80)";
  if(b==="Gold") return "rgba(251,191,36,.75)";
  if(b==="Silver") return "rgba(233,238,252,.45)";
  if(b==="Bronze") return "rgba(251,113,133,.55)";
  return "rgba(110,168,255,.75)";
}

/* ===================== Donut + Radar + Timeline + PNG ===================== */
function drawDonut(){
  const c=$("donut"),ctx=c.getContext("2d");
  const w=c.width,h=c.height;
  ctx.clearRect(0,0,w,h);

  const overall = calcOverall();
  const cx=w*0.18, cy=h*0.55, r=Math.min(w,h)*0.30;
  const start=-Math.PI/2, end=start + overall*2*Math.PI;

  ctx.lineWidth = 26;
  ctx.strokeStyle = "rgba(255,255,255,.10)";
  ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI); ctx.stroke();

  ctx.strokeStyle = "rgba(110,168,255,.75)";
  ctx.beginPath(); ctx.arc(cx,cy,r,start,end); ctx.stroke();

  ctx.fillStyle = "rgba(233,238,252,.95)";
  ctx.font = "900 34px system-ui";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(Math.round(overall*100)+"%", cx, cy-6);
  ctx.font = "600 16px system-ui";
  ctx.fillStyle = "rgba(169,180,214,.95)";
  ctx.fillText("Overall ×™×“×¢", cx, cy+28);

  const x2=w*0.40, y2=h*0.22;
  ctx.textAlign="right"; ctx.textBaseline="alphabetic";
  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="800 18px system-ui";
  ctx.fillText("×¤×™×¨×•×§ ××”×™×¨", w-24, y2);

  ctx.font="600 14px system-ui";
  ctx.fillStyle="rgba(169,180,214,.95)";
  const lines=[
    `×“×™×•×§: ${fmtPct(state.acc)}`,
    `× ×¢× ×•: ${state.answered||0}`,
    `×¨×¦×£: ${state.streak||0}`,
    `×—×–×¨×•×ª ×‘×ª×•×¨: ${state.reviewQueue.length}`
  ];
  lines.forEach((t,i)=>ctx.fillText(t, w-24, y2+30+i*22));
}

function drawBadges(stats){
  const box = $("badges");
  box.innerHTML = "";
  TOPICS.forEach(t=>{
    const b = stats[t].badge;
    const score = Math.round(stats[t].score*100);
    const total = stats[t].total;
    const el = document.createElement("div");
    el.className = "badge";
    el.style.background = badgeColor(b);
    el.innerHTML = `<span class="dot"></span><span class="bname">${escapeHtml(t)}</span> â€” ${escapeHtml(b)} â€¢ ${score}% â€¢ N=${total}`;
    box.appendChild(el);
  });
}

function drawRadar(){
  const c=$("radar"),ctx=c.getContext("2d");
  const w=c.width,h=c.height;
  ctx.clearRect(0,0,w,h);

  const stats = topicStats();
  const scores = TOPICS.map(t=>stats[t].score);
  const cx=w*0.50, cy=h*0.50;
  const R=Math.min(w,h)*0.38;
  const n=TOPICS.length;

  ctx.strokeStyle="rgba(255,255,255,.10)";
  ctx.lineWidth=2;
  for(let g=1; g<=4; g++){
    const r=R*(g/4);
    ctx.beginPath();
    for(let i=0;i<n;i++){
      const ang = -Math.PI/2 + (i*2*Math.PI/n);
      const x=cx + r*Math.cos(ang);
      const y=cy + r*Math.sin(ang);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath(); ctx.stroke();
  }

  ctx.strokeStyle="rgba(255,255,255,.12)";
  ctx.lineWidth=2;
  for(let i=0;i<n;i++){
    const ang = -Math.PI/2 + (i*2*Math.PI/n);
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx + R*Math.cos(ang), cy + R*Math.sin(ang));
    ctx.stroke();
  }

  ctx.fillStyle="rgba(110,168,255,.18)";
  ctx.strokeStyle="rgba(110,168,255,.70)";
  ctx.lineWidth=3;
  ctx.beginPath();
  for(let i=0;i<n;i++){
    const ang = -Math.PI/2 + (i*2*Math.PI/n);
    const r = R * scores[i];
    const x = cx + r*Math.cos(ang);
    const y = cy + r*Math.sin(ang);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.closePath(); ctx.fill(); ctx.stroke();

  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="700 14px system-ui";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  for(let i=0;i<n;i++){
    const ang = -Math.PI/2 + (i*2*Math.PI/n);
    const x = cx + (R+52)*Math.cos(ang);
    const y = cy + (R+52)*Math.sin(ang);
    const label = TOPICS[i].length>12 ? TOPICS[i].replace(" ×•××“×™× ×”","") : TOPICS[i];
    ctx.fillText(label, x, y);
  }

  const sw = strengthWeakList(stats);
  const best = sw.best.map(x=>`â€¢ ${x.t} (${Math.round(x.score*100)}%)`).join("\n") || "â€”";
  const worst= sw.worst.map(x=>`â€¢ ${x.t} (${Math.round(x.score*100)}%)`).join("\n") || "â€”";
  $("strengthWeak").innerHTML =
    `<b>×—×–×§×•×ª</b><br>${escapeHtml(best).replaceAll("\n","<br>")}<br><br><b>×—×œ×©×•×ª</b><br>${escapeHtml(worst).replaceAll("\n","<br>")}`;

  drawBadges(stats);
}

function startOfDay(ts){
  const d = new Date(ts);
  d.setHours(0,0,0,0);
  return d.getTime();
}
function formatDay(ts){
  const d=new Date(ts);
  const dd=String(d.getDate()).padStart(2,"0");
  const mm=String(d.getMonth()+1).padStart(2,"0");
  return `${dd}/${mm}`;
}
function aggregateDaily(days){
  const end = startOfDay(now());
  const start = end - (days-1)*24*60*60*1000;
  const map = new Map();
  for(let t=start; t<=end; t+=24*60*60*1000) map.set(t,{ans:0,ok:0});
  for(const h of state.history){
    const d = startOfDay(h.t);
    if(d<start || d>end) continue;
    const obj = map.get(d);
    obj.ans += 1;
    obj.ok += (h.ok?1:0);
  }
  let cumA=0, cumOk=0;
  const xs=[], dailyAcc=[], overall=[];
  for(const [day,val] of map.entries()){
    xs.push(day);
    cumA += val.ans;
    cumOk += val.ok;
    const accDaily = val.ans ? (val.ok/val.ans) : null;
    const overallWin = cumA ? (cumOk/cumA) : null;
    dailyAcc.push(accDaily);
    overall.push(overallWin);
  }
  return {xs, dailyAcc, overall};
}
function drawTimeline(){
  const days = state.windowDays || 7;
  $("w7Btn").className = (days===7) ? "primary" : "";
  $("w30Btn").className = (days===30) ? "primary" : "";

  const c=$("timeline"),ctx=c.getContext("2d");
  const w=c.width,h=c.height;
  ctx.clearRect(0,0,w,h);

  ctx.strokeStyle="rgba(255,255,255,.10)";
  ctx.lineWidth=2;
  ctx.strokeRect(10,10,w-20,h-20);

  const padL=50, padR=20, padT=22, padB=40;
  const x0=padL, x1=w-padR, y0=h-padB, y1=padT;

  ctx.strokeStyle="rgba(255,255,255,.08)";
  ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=y0 - (i/4)*(y0-y1);
    ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
  }

  const series = aggregateDaily(days);
  const n=series.xs.length;
  const dx=(x1-x0)/(n-1);

  function plot(arr, strokeStyle, lineWidth){
    ctx.strokeStyle=strokeStyle;
    ctx.lineWidth=lineWidth;
    ctx.beginPath();
    let started=false;
    for(let i=0;i<n;i++){
      const v=arr[i];
      if(v==null) continue;
      const x=x0+i*dx;
      const y=y0 - v*(y0-y1);
      if(!started){ctx.moveTo(x,y); started=true;}
      else ctx.lineTo(x,y);
    }
    if(started) ctx.stroke();
  }

  plot(series.overall, "rgba(110,168,255,.75)", 4);
  plot(series.dailyAcc, "rgba(233,238,252,.40)", 3);

  ctx.fillStyle="rgba(169,180,214,.95)";
  ctx.font="600 12px system-ui";
  ctx.textAlign="center";
  for(let i=0;i<n;i++){
    if(days===30 && i%5!==0 && i!==n-1) continue;
    const x=x0+i*dx;
    ctx.fillText(formatDay(series.xs[i]), x, h-16);
  }

  ctx.textAlign="right";
  for(let i=0;i<=4;i++){
    const v=i/4;
    const y=y0 - v*(y0-y1);
    ctx.fillText(Math.round(v*100)+"%", x0-10, y+4);
  }

  ctx.textAlign="right";
  ctx.fillStyle="rgba(233,238,252,.85)";
  ctx.fillText("Overall (×—×œ×•×Ÿ)", w-20, 26);
  ctx.fillStyle="rgba(233,238,252,.55)";
  ctx.fillText("Accuracy ×™×•××™", w-20, 48);
}

function saveShareCardPng(){
  const donut=$("donut"), radar=$("radar");
  const stats=topicStats();
  const overall=Math.round(calcOverall()*100);
  const accTxt = fmtPct(state.acc);
  const answered = state.answered||0;

  const pad=26, W=1100, H=1600;
  const out=document.createElement("canvas"); out.width=W; out.height=H;
  const ctx=out.getContext("2d");

  ctx.fillStyle="#0b1220"; ctx.fillRect(0,0,W,H);
  ctx.fillStyle="rgba(255,255,255,.04)";
  roundRect(ctx, pad, pad, W-2*pad, H-2*pad, 22, true, false);

  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="900 28px system-ui";
  ctx.textAlign="right";
  ctx.fillText("×›×¨×˜×™×¡ ×™×“×¢ â€¢ 500 ×©××œ×•×ª", W-pad, pad+36);

  ctx.fillStyle="rgba(169,180,214,.95)";
  ctx.font="600 14px system-ui";
  ctx.fillText(`Overall: ${overall}% â€¢ ×“×™×•×§: ${accTxt} â€¢ × ×¢× ×•: ${answered}`, W-pad, pad+62);

  ctx.drawImage(donut, pad+20, pad+85, 520, 210);
  ctx.drawImage(radar, pad+20, pad+320, W-2*pad-40, 620);

  ctx.fillStyle="rgba(233,238,252,.95)";
  ctx.font="800 18px system-ui";
  ctx.fillText("×“×¨×’×•×ª ×œ×¤×™ ×ª×—×•×", W-pad, pad+1000);

  ctx.font="600 14px system-ui";
  ctx.fillStyle="rgba(169,180,214,.95)";
  let y=pad+1030;
  const rows = [];
  TOPICS.forEach(t=>{
    const b=stats[t].badge;
    const sc=Math.round(stats[t].score*100);
    const n=stats[t].total;
    rows.push(`${t}: ${b} â€¢ ${sc}% â€¢ N=${n}`);
  });
  const col1 = rows.slice(0,6);
  const col2 = rows.slice(6,12);
  const x1 = W-pad;
  const x2 = W/2 + 40;
  col1.forEach((r,i)=>ctx.fillText(r, x1, y+i*26));
  col2.forEach((r,i)=>ctx.fillText(r, x2, y+i*26));

  ctx.fillStyle="rgba(169,180,214,.80)";
  ctx.font="600 12px system-ui";
  ctx.fillText(`Seed: ${SEED} â€¢ ${new Date().toLocaleString("he-IL")}`, W-pad, H-pad);

  const a=document.createElement("a");
  a.download = "×›×¨×˜×™×¡-×™×“×¢.png";
  a.href = out.toDataURL("image/png");
  a.click();
}

/* ===================== UI render & quiz ===================== */
function drawStats(){
  const overall = calcOverall();
  $("overallPill").textContent = Math.round(overall*100)+"%";
  $("accPill").textContent = fmtPct(state.acc);
  $("answeredPill").textContent = state.answered||0;
  $("streakPill").textContent = state.streak||0;

  $("answeredStat").textContent = state.answered||0;
  $("correctStat").textContent = state.correct||0;
  $("reviewStat").textContent = state.reviewQueue.length;

  const q = state.current;
  if(q){
    const tp = getTopicProg(q.topic);
    $("topicLvlStat").textContent = `${tp.lvl}/5`;
    $("topicLabel").textContent = `${q.topic} â€¢ ×¨××” ${tp.lvl}/5`;
    $("xpText").textContent = `×”×ª×§×“××•×ª ×‘× ×•×©×: XP ${Math.round(tp.xp)} / 100 â€¢ ×¨×¦×£ ×‘× ×•×©×: ${tp.streakInTopic}`;
    $("xpBar").style.width = clamp((tp.xp/100)*100,0,100)+"%";

    // topic meter value: mix of topic accuracy + depth
    const accT = tp.attempts ? (tp.correct/tp.attempts) : 0;
    const depthT = clamp(Math.sqrt(tp.attempts/20),0,1);
    const valT = clamp(accT*0.75 + depthT*0.25, 0, 1);

    const stats = topicStats();
    const badge = stats[q.topic]?.badge || "New";
    const tone = toneForBadge(badge);

    $("overallLabel").textContent = `Overall ${Math.round(overall*100)}%`;
    drawCircularMeter("meterOverall", overall, "Overall", "×ª××•× ×ª ××¦×‘ ×›×œ×œ×™×ª", "rgba(110,168,255,.80)");
    drawCircularMeter("meterTopic", valT, "× ×•×©×", `${badge} â€¢ ${Math.round(valT*100)}%`, tone);
  } else {
    $("xpText").textContent = "×”×ª×§×“××•×ª ×‘× ×•×©×: â€”";
    $("xpBar").style.width = "0%";
  }

  drawDonut();
  drawRadar();
  drawTimeline();
  saveState();
}

function setCurrent(q){
  state.current=q; state.lock=false; saveState();

  const tp = getTopicProg(q.topic);

  $("qMeta").innerHTML=[
    `×ª×—×•×: ${q.topic}`,
    `××–×•×¨: ${q.region}`,
    `×§×•×©×™: ${(q.difficulty||3)}/5`,
    `×¨××” ×‘×ª×—×•×: ${tp.lvl}/5`,
    `#${q.id.replace("q_","")}`
  ].map(x=>`<span class="tag">${escapeHtml(x)}</span>`).join("");

  $("qText").textContent=q.q;

  const box=$("answers");
  box.innerHTML="";
  $("feedbackBox").style.display="none";

  const keys=["1","2","3","4"];
  q.options.forEach((opt,idx)=>{
    const d=document.createElement("div");
    d.className="ans"; d.dataset.idx=idx;
    d.innerHTML=`<div class="key">${keys[idx]}</div><div class="label">${escapeHtml(opt)}</div>`;
    d.onclick=()=>selectAnswer(idx);
    box.appendChild(d);
  });
  drawStats();
}

function nextQuestion(){
  const q=pickQuestion();
  if(!q){
    $("qText").textContent="××™×Ÿ ×©××œ×•×ª ×–××™× ×•×ª (×›×™×‘×™×ª ××ª ×›×œ ×”×ª×—×•××™×).";
    $("answers").innerHTML="";
    return;
  }
  setCurrent(q);
}

function selectAnswer(idx){
  if(!state.current || state.lock) return;
  state.lock=true;
  const q=state.current;
  const ok = idx===q.answer;

  // per-question stats
  const seen=state.seen[q.id]||{correctCount:0,wrongCount:0,lastSeen:0,flagged:false};
  seen.lastSeen=now();
  if(ok) seen.correctCount=(seen.correctCount||0)+1;
  else seen.wrongCount=(seen.wrongCount||0)+1;
  state.seen[q.id]=seen;

  // global stats
  state.answered += 1;
  if(ok) state.correct += 1;
  state.acc = state.correct/state.answered;
  state.streak = ok ? (state.streak+1) : 0;

  // topic progression (hard gradual)
  const tp = updateTopicProgress(q.topic, ok, q.difficulty||3);

  // history
  state.history.push({t:now(), ok, topic:q.topic, topicLvl:tp.lvl});
  if(state.history.length>2500) state.history = state.history.slice(-2500);

  // schedule reviews
  scheduleReview(q.id, ok);

  // paint UI choices
  const nodes=Array.from(document.querySelectorAll(".ans"));
  nodes.forEach(n=>{
    const i=Number(n.dataset.idx);
    if(i===q.answer) n.classList.add("correct");
    if(i===idx && !ok) n.classList.add("wrong");
    n.style.pointerEvents="none";
  });

  $("feedbackText").innerHTML=(ok?`<b style="color:var(--good)">× ×›×•×Ÿ âœ…</b>`:`<b style="color:var(--bad)">×œ× ××“×•×™×§ âŒ</b>`)
    + `<div style="margin-top:6px">${escapeHtml(q.explain)}</div>`;
  $("hintText").textContent=q.hint||"";
  $("feedbackBox").style.display="block";

  saveState();
  drawStats();
}

/* ===================== Buttons & init ===================== */
$("startBtn").onclick=()=>{
  state.started=true; saveState();
  $("screen_intro").style.display="none";
  $("screen_quiz").style.display="block";
  nextQuestion();
};
$("skipBtn").onclick=()=>{ if(!state.current) return; state.streak=0; saveState(); nextQuestion(); };
$("nextBtn").onclick=()=>nextQuestion();
$("flagBtn").onclick=()=>{
  if(!state.current) return;
  state.seen[state.current.id]=state.seen[state.current.id]||{correctCount:0,wrongCount:0,lastSeen:0,flagged:false};
  state.seen[state.current.id].flagged=!state.seen[state.current.id].flagged;
  saveState(); toast(state.seen[state.current.id].flagged?"×¡×•××Ÿ ×œ×—×–×¨×”":"×‘×•×˜×œ ×¡×™××•×Ÿ");
};
$("resetBtn").onclick=()=>{ if(confirm("×œ××¤×¡ ×”×›×œ? ×–×” ×™××—×§ ×”×ª×§×“××•×ª.")) hardReset(); };

$("copyStatsBtn").onclick=()=>{
  const stats=topicStats();
  const summary={
    date:new Date().toISOString(), seed:SEED, bankSize:500,
    answered:state.answered, correct:state.correct, accuracy:state.acc,
    overall:Math.round(calcOverall()*100),
    reviewsQueued:state.reviewQueue.length,
    topicProgress:Object.fromEntries(TOPICS.map(t=>[t,state.topicProg[t]])),
    topicBadges:Object.fromEntries(TOPICS.map(t=>[t,stats[t].badge])),
    topicScores:Object.fromEntries(TOPICS.map(t=>[t,Math.round(stats[t].score*100)])),
  };
  const txt=JSON.stringify(summary,null,2);
  navigator.clipboard?.writeText(txt).then(()=>toast("×”×“×•×— ×”×•×¢×ª×§ ×œ×œ×•×—")).catch(()=>toast("×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§"));
};

$("savePngBtn").onclick=()=>saveShareCardPng();
$("w7Btn").onclick=()=>{state.windowDays=7; saveState(); drawTimeline(); drawStats();};
$("w30Btn").onclick=()=>{state.windowDays=30; saveState(); drawTimeline(); drawStats();};

window.addEventListener("keydown",(e)=>{
  if($("screen_quiz").style.display==="none") return;
  if(!state.current) return;
  if(e.key>="1" && e.key<="4"){
    const idx=Number(e.key)-1;
    const node=document.querySelector(`.ans[data-idx="${idx}"]`);
    if(node && node.style.pointerEvents!=="none") selectAnswer(idx);
  }
  if(e.key.toLowerCase()==="n"){
    if($("feedbackBox").style.display!=="none") nextQuestion();
  }
});

drawStats();
</script>
</body>
</html>
